object_extend("mstSvtSkill",'{"strengthStatus":0,"svtId":9941040,"num":1,"priority":1,"skillId":435350,"condQuestId":0,"condQuestPhase":0,"condLv":0,"condLimitCount":-1,"eventId":0},{"strengthStatus":0,"svtId":9941040,"num":2,"priority":1,"skillId":436450,"condQuestId":0,"condQuestPhase":0,"condLv":0,"condLimitCount":-1,"eventId":0},{"strengthStatus":0,"svtId":9941040,"num":3,"priority":1,"skillId":437551,"condQuestId":0,"condQuestPhase":0,"condLv":0,"condLimitCount":-1,"eventId":0}');
object_extend("mstSvtSkill",'{"svtId":9940380,"num":1,"priority":1,"skillId":960182,"condQuestId":0,"condLv":0,"condLimitCount":-1},{"svtId":9940390,"num":1,"priority":1,"skillId":960184,"condQuestId":0,"condLv":0,"condLimitCount":-1},{"svtId":9940400,"num":1,"priority":1,"skillId":960183,"condQuestId":0,"condLv":0,"condLimitCount":-1},{"svtId":9940410,"num":1,"priority":1,"skillId":960185,"condQuestId":0,"condLv":0,"condLimitCount":-1},{"svtId":9940530,"num":1,"priority":2,"skillId":960189,"condQuestId":0,"condLv":0,"condLimitCount":-1},{"svtId":9940530,"num":2,"priority":2,"skillId":960190,"condQuestId":0,"condLv":0,"condLimitCount":-1},{"svtId":9940530,"num":3,"priority":2,"skillId":960191,"condQuestId":0,"condLv":0,"condLimitCount":-1},{"svtId":9940530,"num":4,"priority":2,"skillId":960192,"condQuestId":0,"condLv":0,"condLimitCount":-1},{"svtId":9940530,"num":5,"priority":2,"skillId":960193,"condQuestId":0,"condLv":0,"condLimitCount":-1},{"svtId":9940530,"num":6,"priority":2,"skillId":960194,"condQuestId":0,"condLv":0,"condLimitCount":-1},{"svtId":9940530,"num":7,"priority":2,"skillId":960195,"condQuestId":0,"condLv":0,"condLimitCount":-1},{"svtId":9940600,"num":4,"priority":1,"skillId":960235,"condQuestId":0,"condLv":0,"condLimitCount":-1}');
object_extend("mstSvtTreasureDevice",'{"damage":[100],"svtId":9935400,"num":1,"priority":426,"imageIndex":0,"treasureDeviceId":441,"condQuestId":0,"condQuestPhase":0,"condLv":0,"condFriendshipRank":0,"motion":50,"cardId":1},{"damage":[16,33,51],"svtId":9935500,"num":1,"priority":101,"imageIndex":0,"treasureDeviceId":9935511,"condQuestId":0,"condQuestPhase":0,"condLv":0,"condFriendshipRank":0,"motion":50,"cardId":1}');
/*
for(var s in master.mstSvt){if(master.mstSvt[s].id==402800){master.mstSvt[s].id=0;break;}}
object_extend("mstSvt",'{"relateQuestIds":[],"individuality":[5000,402800,1,103,202,300,304,2009,1000,2001,2008,2005,2113],"classPassive":[34250,88650],"cardIds":[3,1,1,2,2],"script":{"cameraActionId":284},"id":402800,"baseSvtId":402800,"name":"イヴァン雷帝","ruby":"イヴァンライテイ","battleName":"イヴァン雷帝","classId":4,"type":5,"limitMax":4,"rewardLv":90,"friendshipId":1049,"maxFriendshipRank":10,"genderType":1,"attri":1,"combineSkillId":402800,"combineLimitId":402800,"sellQp":5000,"sellMana":9,"sellRarePri":5,"expType":10,"combineMaterialId":5,"cost":16,"battleSize":8,"hpGaugeY":-1000,"starRate":89,"deathRate":400,"attackAttri":1,"illustratorId":27,"cvId":37,"collectionNo":205,"materialStoryPriority":0}');

object_extend("mstTreasureDevice",'{"individuality":[3002,4003,4007],"script":{},"id":402801,"seqId":402800,"name":"我が旅路に従え獣","ruby":"ズヴェーリ・クレースニーホッド","rank":"A+","maxLv":5,"typeText":"対人宝具","attackAttri":1}');
object_extend("mstTreasureDeviceLv",'{"treaureDeviceId":402801,"lv":1,"gaugeCount":1,"detailId":402801,"tdPoint":62,"tdPointQ":62,"tdPointA":62,"tdPointB":62,"tdPointEx":62,"tdPointDef":300,"qp":80000}');
object_extend("mstSvtTreasureDevice",'{"damage":[6,13,20,26,35],"strengthStatus":0,"svtId":402800,"num":1,"priority":101,"flag":0,"imageIndex":0,"treasureDeviceId":402801,"condQuestId":0,"condQuestPhase":0,"condLv":0,"condFriendshipRank":0,"motion":50,"cardId":2}');
object_extend("mstCombineLimit",'{"itemIds":[7004],"itemNums":[5],"id":402800,"svtLimit":0,"qp":100000},{"itemIds":[7004,6516],"itemNums":[12,22],"id":402800,"svtLimit":1,"qp":300000},{"itemIds":[7104,6513,6528],"itemNums":[5,10,3],"id":402800,"svtLimit":2,"qp":1000000},{"itemIds":[7104,6528,6529],"itemNums":[12,6,5],"id":402800,"svtLimit":3,"qp":3000000}');
object_extend("mstCombineSkill",'{"itemIds":[6004],"itemNums":[5],"id":402800,"skillLv":1,"qp":200000},{"itemIds":[6004],"itemNums":[12],"id":402800,"skillLv":2,"qp":400000},{"itemIds":[6104],"itemNums":[5],"id":402800,"skillLv":3,"qp":1200000},{"itemIds":[6104,6513],"itemNums":[12,5],"id":402800,"skillLv":4,"qp":1600000},{"itemIds":[6204,6513],"itemNums":[5,10],"id":402800,"skillLv":5,"qp":4000000},{"itemIds":[6204,6516],"itemNums":[12,15],"id":402800,"skillLv":6,"qp":5000000},{"itemIds":[6516,6527],"itemNums":[29,15],"id":402800,"skillLv":7,"qp":10000000},{"itemIds":[6527,6535],"itemNums":[44,24],"id":402800,"skillLv":8,"qp":12000000},{"itemIds":[6999],"itemNums":[1],"id":402800,"skillLv":9,"qp":20000000}');
*/
function object_extend(key,extendtxt)
{
	var isErr = false;
	extendtxt = extendtxt.replace(/\n/g,"\\n").replace(/\\"/g,"\\\"").replace(/\"なし\"/g,"\"－\"");
	try{
		var tmpMst = JSON.parse('['+extendtxt+']');
		for(var i in tmpMst)
		{
			master[key].push(tmpMst[i]);
		}
	}
	catch(err){console.log(err.message+'\n'+key);isErr=true;}
	if(isErr) alert('存取錯誤');
}
/*暫時應對*/
sortByElmentNo(master.mstSvt);
var zhTWNo = 168;
var zhCNNo = 191;
var statusNo = 234;
var personalityList = ["","善","惡","?","狂","中庸","?","花嫁","夏"];
var policyList = ["","中立","混沌","秩序","?","?","中立"];
var attriList = ["？","人","天","地","星","獸"];
var genderTypeList = ["","男性","女性","不明"];
var cardList = ["","0000ff","ff0000","00ff00"];
var svtStatusList = ["","A","B","C","D","E","EX","?","?",""];
var svtStatusPlusList = ["","","+","++","?","+++","-","?","？","－"];
var individualityList = [[1172,"人類威脅"],[2000,"神性"],[2001,"人型"],[2002,"龍"],[2004,"羅馬"],[2005,"猛獸"],[2007,"阿爾托莉亞臉"],[2008,"被「天地乖離開辟之星」所剋"],[2009,"騎乘"],[2010,"亞瑟"],[2011,"被「人類神話・雷電降臨」所剋"],[2012,"所愛之人"],[2018,"死靈與惡魔"],[2019,"魔性"],[2037,"被「神秘殺し」所剋"],[2113,"王"],[2114,"希臘神話系男性"],[2355,"伊莉雅"],[2356,"「紳士的な愛 C」除女性外的對象"]];
function svtDataTable(svtId)
{
	var c;
	
	var i;
	for(i in master.mstSvt)
	{
		if(master.mstSvt[i].id==svtId)break;
	}
	var j,tmpSvtLimit=null;
	for(j in master.mstSvtLimit)
	{
		if(master.mstSvtLimit[j].svtId==svtId){tmpSvtLimit=master.mstSvtLimit[j];break;}
	}
	var jm,tmpSvtLimitMax=null;
	for(jm in master.mstSvtLimit)
	{
		if(master.mstSvtLimit[jm].svtId==svtId&&master.mstSvtLimit[jm].limitCount==master.mstSvt[i].limitMax)
		{tmpSvtLimitMax=master.mstSvtLimit[jm];break;}
	}
	var svtNrmlDataTxt="<tr>";
	if(master.mstSvt[i].collectionNo<=statusNo)
	{
		svtNrmlDataTxt+="<td rowspan=7 align=center style='width:25%;height:300px;'>";
		if(master.mstSvt[i].type==5||master.mstSvt[i].type==9||master.mstSvt[i].type==99)
			svtNrmlDataTxt+="<img src=common/images/Servant/"+svtId+"_status_servant_2.png onerror=\"javascript:this.style='display:none'\" width=256 height=256 /></td>";
		else svtNrmlDataTxt+="<div class='slide'><div><img src=common/images/Servant/"+svtId+"_status_servant_1.png onerror=\"this.style.display = 'none'\" width=256 height=256 /></div><div><img src=common/images/Servant/"+svtId+"_status_servant_2.png onerror=\"this.style.display = 'none'\" width=256 height=256 /></div><div><img src=common/images/Servant/"+svtId+"_status_servant_3.png onerror=\"this.style.display = 'none'\" width=256 height=256 /></div></div></td>";
	}
	else{svtNrmlDataTxt+="<td rowspan=7 align=center style='width:25%;height:300px;'><img src='common/images/icon/faces/"+master.mstSvt[i].id+"0.png' onerror=javascript:this.src='common/images/icon/faces/0.png'></td>"}
		svtNrmlDataTxt+="<th style='width:10%;'><b>編號</b></th><th style='width:10%;'><b>星數</b></th><th colspan=2 style='width:35%;'><b>名稱</b></th><th style='width:15%;'><b>職階</b></th><th style='width:10%;'><b>分類</b></th></tr><tr align=\"center\"><td>No."+master.mstSvt[i].collectionNo+"</td><td class=\"star\">";
	for(c=0;c<tmpSvtLimit.rarity;c++)
		svtNrmlDataTxt+="★";
	if(tmpSvtLimitMax!=null&&tmpSvtLimitMax.rarity!=tmpSvtLimit.rarity)
	{
		svtNrmlDataTxt+="<br>";
		for(c=0;c<tmpSvtLimitMax.rarity;c++)
			svtNrmlDataTxt+="★";
	}
	if(tmpSvtLimit.rarity==0)svtNrmlDataTxt+="－";
	svtNrmlDataTxt+="</td><td colspan=2>";
	var svtNameZh = findSvtNameZh(master.mstSvt[i].id);
	if(svtNameZh&&!document.getElementById('isJpTxt').checked)
		{svtNrmlDataTxt+="<div class=ruby>" + master.mstSvt[i].ruby + "</div>" + svtNameZh;}
	else {svtNrmlDataTxt+=master.mstSvt[i].name;}
	svtNrmlDataTxt+="</td>";
	document.title = findSvtNameZh2(svtId)+" - Servant資料查詢";
	for(c=0;c<mstClass.length;c++)
		if(mstClass[c].id==master.mstSvt[i].classId) {svtNrmlDataTxt+="<td>"+mstClass[c].name+"</td>";break;}
	
	svtNrmlDataTxt+="<td>"+attriList[master.mstSvt[i].attri]+"</td></tr><tr><th><b>HP</b></th><th><b>ATK</b></th><th style='width:10%;'><b>繪師</b></th><th style='width:10%;'><b>CV</b></th><th><b>屬性</b></th><th><b>性別</b></th></tr><tr align=\"center\"><td>"+tmpSvtLimit.hpBase+" / "+tmpSvtLimit.hpMax;
	if(tmpSvtLimitMax!=null&&(tmpSvtLimit.hpBase!=tmpSvtLimitMax.hpBase||tmpSvtLimit.hpMax!=tmpSvtLimitMax.hpMax))
	{
		svtNrmlDataTxt+="<br>"+tmpSvtLimitMax.hpBase+" / "+tmpSvtLimitMax.hpMax;
	}
	svtNrmlDataTxt+="</td><td>"+tmpSvtLimit.atkBase+" / "+tmpSvtLimit.atkMax;
	if(tmpSvtLimitMax!=null&&(tmpSvtLimit.atkBase!=tmpSvtLimitMax.atkBase||tmpSvtLimit.atkMax!=tmpSvtLimitMax.atkMax))
	{
		svtNrmlDataTxt+="<br>"+tmpSvtLimitMax.atkBase+" / "+tmpSvtLimitMax.atkMax;
	}
	svtNrmlDataTxt+="</td><td>";
	if(master.mstSvt[i].illustratorId!=-1)
		for(c=0;c<master.mstIllustrator.length;c++){
			if(master.mstIllustrator[c].id==master.mstSvt[i].illustratorId) {svtNrmlDataTxt+="<a href='illustrator.html#"+master.mstSvt[i].illustratorId+"'>"+master.mstIllustrator[c].name.replace(/\(/g,"<br>(")+"</a>";break;}
		}
	else svtNrmlDataTxt+="？？？";
	svtNrmlDataTxt+="</td><td>";
	if(master.mstSvt[i].cvId!=-1)
		for(c=0;c<master.mstCv.length;c++){
			if(master.mstCv[c].id==master.mstSvt[i].cvId) {svtNrmlDataTxt+="<a href='cv.html#"+master.mstSvt[i].cvId+"'>"+master.mstCv[c].name.replace(/＆/g,"<br>")+"</a>";break;}
		}
	else svtNrmlDataTxt+="？？？";
	svtNrmlDataTxt+="</td>";
	svtNrmlDataTxt+="<td>"+policyList[tmpSvtLimit.policy]+"・"+personalityList[tmpSvtLimit.personality]+"</td><td>"+genderTypeList[master.mstSvt[i].genderType]+"</td></tr>";
	
	var traitArray = new Array();
	for(c in master.mstSvt[i].individuality)
		for(var k in individualityList)
			if(master.mstSvt[i].individuality[c]==individualityList[k][0]) traitArray.push(individualityList[k][1]);
	svtNrmlDataTxt+="<tr><th>特性</th><td colspan=5 align=center>"+traitArray+"</td></tr>";
	
	/*svtNrmlDataTxt+="<tr><th>召喚台詞</th><td colspan=5>";var tmpTxt="";
	for(c in master.mstSvtVoice)
	{
		if(master.mstSvtVoice[c].id==master.mstSvt[i].id&&master.mstSvtVoice[c].type==3)
		{
			if(master.mstSvtVoice[c].scriptJson[0])
			{for(k in master.mstSvtVoice[c].scriptJson[0].infos)
				{
					tmpTxt+=master.mstSvtVoice[c].scriptJson[0].infos[k].text;
				}
			}
			if(tmpTxt.length>0)svtNrmlDataTxt+="<span style='text-align:center;font-style: italic;'>「"+tmpTxt.replace(/\[r\]/g,"")+"」</span>";
			break;
		}
	}
	svtNrmlDataTxt+="</td></tr>";*/
	document.getElementById("svtNrmlData").innerHTML=svtNrmlDataTxt;
	
	var svtCtrlDataTxt="";
	svtCtrlDataTxt+="<tr><th rowspan=2><b>指令卡</b></th><th><font color=\"#0099FF\"><b>Arts</b></font></th><th><font color=\"#ff0000\"><b>Buster</b></font></th><th><font color=\"#00ff00\"><b>Quick</b></font></th><th><b>Extra</b></th><th rowspan=2><b>隱藏數值</b></th><th><b>星星發生率</b></th><th><b>被即死率</b></th><th><b>星星分配比重</b></th><th rowspan=2><b>NP獲得率</b></th><th><font color=\"#0099FF\"><b>Arts</b></font></th><th><font color=\"#ff0000\"><b>Buster</b></font></th><th><font color=\"#00ff00\"><b>Quick</b></font></th><th><b>Extra</b></th><th><b>寶具</b></th><th><b>防禦</b></th></tr><tr align=\"center\">";
	var artHit,busterHit,quickHit,exHit;
	for(var k=1;k<=4;k++)
	{
		svtCtrlDataTxt+="<td>";
		var cardCount=0;
		for(c=0;c<master.mstSvt[i].cardIds.length;c++)
			if(master.mstSvt[i].cardIds[c]==k) cardCount++;
		if(k!=4) svtCtrlDataTxt+=cardCount+"張";
		for(c=0;c<master.mstSvtCard.length;c++)
		{
			if(master.mstSvtCard[c].svtId==master.mstSvt[i].id&&master.mstSvtCard[c].cardId==k){
				if(k!=4) svtCtrlDataTxt+=" 各";
				svtCtrlDataTxt+=master.mstSvtCard[c].normalDamage.length+"Hit";
				if(master.mstSvtCard[c].normalDamage.length>1) svtCtrlDataTxt+="s";
				
				if(master.mstSvtCard[c].cardId==1) artHit=master.mstSvtCard[c].normalDamage.length;
				else if(master.mstSvtCard[c].cardId==2) busterHit=master.mstSvtCard[c].normalDamage.length;
				else if(master.mstSvtCard[c].cardId==3) quickHit=master.mstSvtCard[c].normalDamage.length;
				else if(master.mstSvtCard[c].cardId==4) exHit=master.mstSvtCard[c].normalDamage.length;
			}
		}
		svtCtrlDataTxt+="</td>";
	}
	svtCtrlDataTxt+="<td>"+master.mstSvt[i].starRate/10+"%</td><td>"+master.mstSvt[i].deathRate/10+"%</td><td>"+tmpSvtLimit.criticalWeight+"</td>";
	var npPoint = new Array();
	for(var n=0; n<6 ; n++){
		npPoint[n] = new Array();
	}
	for(var st in master.mstSvtTreasureDevice)
	{
		if(master.mstSvtTreasureDevice[st].svtId==master.mstSvt[i].id&&master.mstSvtTreasureDevice[st].priority!=0)
		{
			for(c in master.mstTreasureDeviceLv)
			{
				if(master.mstTreasureDeviceLv[c].treaureDeviceId==master.mstSvtTreasureDevice[st].treasureDeviceId){
					var npPointTmp = [master.mstTreasureDeviceLv[c].tdPointA,master.mstTreasureDeviceLv[c].tdPointB,master.mstTreasureDeviceLv[c].tdPointQ,master.mstTreasureDeviceLv[c].tdPointEx,master.mstTreasureDeviceLv[c].tdPoint,master.mstTreasureDeviceLv[c].tdPointDef];
					for(n=0; n<6 ; n++){
						if(npPoint[n].length==0||npPoint[n][npPoint[n].length-1]!=npPointTmp[n]) npPoint[n].push(npPointTmp[n])
					}
			/*svtCtrlDataTxt+=master.mstTreasureDeviceLv[c].tdPointA/100+"%</td><td>"+master.mstTreasureDeviceLv[c].tdPointB/100+"%</td><td>"+master.mstTreasureDeviceLv[c].tdPointQ/100+"%</td><td>"+master.mstTreasureDeviceLv[c].tdPointEx/100+"%</td><td>"+master.mstTreasureDeviceLv[c].tdPoint/100+"%</td><td>"+master.mstTreasureDeviceLv[c].tdPointDef/100+"%";
			break;*/
				}
			}
		}
	}
	for(n=0; n<6 ; n++){
		svtCtrlDataTxt+="<td>"+npArray(npPoint[n])+"</td>";
	}
	svtCtrlDataTxt+="</tr>";
	document.getElementById("svtCtrlData").innerHTML=svtCtrlDataTxt;
	
	var svtSkTdDataTxt="";
	var skillText="";
	var skillrowCount=1;
	for(c=0;c<master.mstSvtSkill.length;c++)
	{
		if(master.mstSvtSkill[c].svtId==master.mstSvt[i].id){
			
			for(var k=0;k<master.mstSkill.length;k++){
				if(master.mstSvtSkill[c].skillId==master.mstSkill[k].id)
				{
					skillText+="<td><img src=common/images/SkillIcon/SkillIcon_"+master.mstSkill[k].iconId+".png onerror=javascript:this.src='common/images/SkillIcon/SkillIcon_0.png' width=55></img></td><td>";
					if(master.mstSvt[i].type!=5) skillText+="<font color=#007979>SKILL "+master.mstSvtSkill[c].num+"</font><br>";
					skillText+="<b>"+master.mstSkill[k].name+"</b></td>"; break;}
			}
			if(master.mstSkill[k]==null) {console.log("技能尋找失敗");continue;}
			else skillrowCount++;
			for(var k=0;k<master.mstSkillLv.length;k++){
				if(master.mstSvtSkill[c].skillId==master.mstSkillLv[k].skillId&&master.mstSkillLv[k].lv==1){
					skillText+="<td colspan=5>冷卻"+master.mstSkillLv[k].chargeTurn+"回合</td>";break;
				}
			}
			
			skillText+="<td colspan=5>";
			if(master.mstSvtSkill[c].condLimitCount==-1) skillText+="敵人或特殊支援限定，冷卻及效果僅供參考";
			else{
			if(master.mstSvtSkill[c].condLimitCount==0&&master.mstSvtSkill[c].condQuestId==0&&master.mstSvtSkill[c].condLv==0) skillText+="初期";
			if(master.mstSvtSkill[c].condLimitCount!=0) skillText+="靈基再臨第"+master.mstSvtSkill[c].condLimitCount+"階段<br>";
			if(master.mstSvtSkill[c].condLv!=0) skillText+="Lv."+master.mstSvtSkill[c].condLv+"<br>";
			if(master.mstSvtSkill[c].condQuestId!=0) skillText+="通過關卡 "+questRea(master.mstSvtSkill[c].condQuestId)+"<br>";
			}
			skillText+="</td></tr>";
			
			var skDetailTxt = new Array();
			for(k=0;k<skDetail.length;k++){
				if(master.mstSvtSkill[c].skillId==skDetail[k][0]){
					skDetailTxt = skDetail[k].slice(0);break;
				}
			}
			if(document.getElementById('isJpTxt').checked||!skDetailTxt[1])
				for(k=0;k<master.mstSkillDetail.length;k++){
					if(master.mstSvtSkill[c].skillId==master.mstSkillDetail[k].id){
						skDetailTxt[1] = master.mstSkillDetail[k].detail;break;
					}
				}
				
			var skDetailArray = new Array();
			if(!document.getElementById('isJpTxt').checked)
			{
				skDetailTxt[1]=skDetailTxt[1].replace(/ ＋ |　＋　/g,"＋");
				skDetailTxt[1]=skDetailTxt[1].replace(/＆/g,"＆┗");
				skDetailArray = skDetailTxt[1].split(/＆|＋/);
			}
			else skDetailArray[0] = skDetailTxt[1].slice(0);
			
			skillrowCount+=skDetailArray.length;
			for(var d=0;d<skDetailArray.length;d++){
				var isLvUp = skDetailArray[d].search(/\{0\}|Lv/);
				skDetailArray[d]=skDetailArray[d].replace(/\{0\}/g,"Lv.");
				skDetailArray[d]=skDetailArray[d].replace(/\[Lv.]/g,"<font color=\"#CC00CC \">[Lv.]</font>");
				skDetailArray[d]=skDetailArray[d].replace(/【/g,"<font color=\"#006400 \">【");
				skDetailArray[d]=skDetailArray[d].replace(/】/g,"】</font>");
				skDetailArray[d]=skDetailArray[d].replace(/\n/g,"<br>");
				skDetailArray[d]=skDetailArray[d].replace(/\[g\]\[o\]▲\[\/o\]\[\/g\]/g,"<font color=\"#ff7f0f \">▲</font>");
				
				if(document.getElementById('isJpTxt').checked) skillText+="<tr><td colspan=12>"+skDetailArray[d]+"</td>";
				
				else{
					skillText+="<tr><td colspan=2>"+skDetailArray[d]+"</td>";
					
					if(skDetailTxt[2+d]&&skDetailTxt[2+d].split("/").length-1>1){
						var skLvArray = new Array();
							skLvArray = skDetailTxt[2+d].split(/\//);
						for(k in skLvArray)
							skillText+="<td align=center style='width:50px'>"+skLvArray[k]+"</td>";
					}
					else{
						skillText+="<td colspan=10>";
						if(skDetailTxt[2+d]) skillText+="　"+skDetailTxt[2+d].replace(/\//g," / ");
						else if(typeof skDetailTxt[2+d] !== 'undefined'&&skDetailTxt[2+d].length==0) skillText+=("　---");
						else skillText+="　待補";
					}
				}
				skillText+="</td></tr>";
			}
		}
	}
	if(skillText.length>0) svtSkTdDataTxt+="<tr><th style='width:60px' rowspan="+skillrowCount+"><b>保有技能</b></th><th colspan=2 style='width:300px'>技能</th><th colspan=5 style='width:250px'>冷卻時間(Lv.6與Lv.10各減少1回合)</th><th colspan=5 style='width:250px'>開放條件</th></tr><tr>"+skillText+"";
		
	if(master.mstSvt[i].classPassive.length!=0){
	skillText="";
	skillrowCount=0;
	for(c=0;c<master.mstSvt[i].classPassive.length;c++)
	{
		skillrowCount++;
		for(var k=0;k<master.mstSkill.length;k++){
			if(master.mstSvt[i].classPassive[c]==master.mstSkill[k].id){skillText+="<td style='width:55px'><img src=common/images/SkillIcon/SkillIcon_"+master.mstSkill[k].iconId+".png onerror=javascript:this.src='common/images/SkillIcon/SkillIcon_0.png' width=55></img></td><td style='width:250px'><b>"+master.mstSkill[k].name+"</b></td>"; break;}
		}skDetailTxt = new Array();
				for(k=0;k<skDetail.length;k++){
					if(master.mstSvt[i].classPassive[c]==skDetail[k][0]){
						skDetailTxt = skDetail[k].slice(0);
						break;
					}
				}
				if(document.getElementById('isJpTxt').checked||!skDetailTxt[1])
					for(k=0;k<master.mstSkillDetail.length;k++){
						if(master.mstSvt[i].classPassive[c]==master.mstSkillDetail[k].id){
							skDetailTxt[1] = master.mstSkillDetail[k].detail;break;
						}
					}
				
				var skDetailArray = new Array();
				if(!document.getElementById('isJpTxt').checked)
				{
					skDetailTxt[1]=skDetailTxt[1].replace(/ ＋ |　＋　/g,"＋");
					skDetailTxt[1]=skDetailTxt[1].replace(/＆/g,"＆┗");
					skDetailArray = skDetailTxt[1].split(/＆|＋|\+/);
				}
				else skDetailArray[0] = skDetailTxt[1].slice(0);
				
				skillText+="<td colspan=10 style='width:500px'>";
				for(var d=0;d<skDetailArray.length;d++){
					var isLvUp = skDetailArray[d].search(/\{0\}|Lv/);
					skDetailArray[d]=skDetailArray[d].replace(/\{0\}/g,"Lv.");
					skDetailArray[d]=skDetailArray[d].replace(/\[Lv.]/g,"<font color=\"#CC00CC \">[Lv.]</font>");
					skDetailArray[d]=skDetailArray[d].replace(/【/g,"<font color=\"#006400 \">【");
					skDetailArray[d]=skDetailArray[d].replace(/】/g,"】</font>");
					skDetailArray[d]=skDetailArray[d].replace(/\n/g,"<br>");
					skDetailArray[d]=skDetailArray[d].replace(/\[g\]\[o\]▲\[\/o\]\[\/g\]/g,"<font color=\"#ff7f0f \">▲</font>");
					
					if(document.getElementById('isJpTxt').checked) skillText+=skDetailArray[d];
					
					else{
						if(d!=0) skillText+="<br>"
						skillText+=skDetailArray[d];
						
						if(skDetailTxt[2+d]&&skDetailTxt[2+d].split("/").length-1>1){
							skillText+=skDetailArray[d]+"：";
							var skLvArray = new Array();
								skLvArray = skDetailTxt[2+d].split(/\//);
							for(k in skLvArray)
								skillText+=skLvArray[k];
						}
						else{
							if(skDetailTxt[2+d]) skillText+="："+skDetailTxt[2+d].replace(/\//g," / ");
							else if(typeof skDetailTxt[2+d] !== 'undefined'&&skDetailTxt[2+d].length==0) skillText+=("");
							else skillText+="：待補";
						}
					}
		}
		skillText+="</td></tr>"
		/*for(var k=0;k<master.mstSkillDetail.length;k++){
			if(master.mstSvt[i].classPassive[c]==master.mstSkillDetail[k].id){
				var skDetailTxt = new Array();
				for(k=0;k<skDetail.length;k++){
					if(master.mstSvt[i].classPassive[c]==skDetail[k][0]){
						skDetailTxt = skDetail[k].slice(0);
						skDetailTxt[1] = skDetailTxt[1].replace(/ /g,"").replace(/＆/g,"＆┗").spilt(/＋|+|＆/g);
						break;
					}
				}
				if(document.getElementById('isJpTxt').checked||!skDetailTxt[1])
					for(k=0;k<master.mstSkillDetail.length;k++){
						if(master.mstSvt[i].classPassive[c]==master.mstSkillDetail[k].id){
							skDetailTxt[1] = master.mstSkillDetail[k].detail;break;
						}
					}
				
				skillText+="<td colspan=10>"+skDetailTxt[1];
				for(var d=2;skDetailTxt[d]&&d<skDetailTxt.length;d++){
					if(skDetailTxt[d]) 
					{
						if(d!=2) skillText+=" / ";else skillText+="：";
						skillText+=skDetailTxt[d].replace(/\//g," / ");
					}
					else break;
				}
				skillText+="</td></tr>";
				break;
			}
		}*/
	}
	if(skillText.length>0) svtSkTdDataTxt+="<tr><th rowspan="+master.mstSvt[i].classPassive.length+"><b>職階技能</b></th>"+skillText+"";}
	
	skillText="";
	skillrowCount=0;
	for(k in master.mstSvtTreasureDevice)
	{
		if(master.mstSvtTreasureDevice[k].svtId==master.mstSvt[i].id&&master.mstSvtTreasureDevice[k].treasureDeviceId!=100)
		{
			for(c=0;c<master.mstTreasureDevice.length;c++)
			{
				if(master.mstTreasureDevice[c].id==master.mstSvtTreasureDevice[k].treasureDeviceId){
					skillrowCount+=2;
					//var k=0;
					skillText+="<th colspan=2 style='width:300px'><b>名稱</b></th><th colspan=2 style='width:100px'><b>等級</b></th><th colspan=2 style='width:100px'><b>種類</b></th><th colspan=4 style='width:200px'><b>解放關卡</b></th><th colspan=2 style='width:100px'>攻擊次數</th></tr>";
					
					skillText+="<tr align=\"center\"><td colspan=2><div class=ruby>"+master.mstTreasureDevice[c].ruby+"</div>";
					//for(k=0;k<master.mstSvtTreasureDevice.length;k++){
						//if(master.mstTreasureDevice[c].id==master.mstSvtTreasureDevice[k].treasureDeviceId){
							skillText+="<b><font color=\"#"+cardList[master.mstSvtTreasureDevice[k].cardId]+"\">"+master.mstTreasureDevice[c].name+"</font></b></td><td colspan=2>"+master.mstTreasureDevice[c].rank+"</td><td colspan=2>"+master.mstTreasureDevice[c].typeText.replace(/／/g,"／<br>").replace(/対/g,"對").replace(/宝/g,"寶").replace(/剣/g,"劍").replace(/悪/g,"惡").replace(/奥/g,"奧").replace(/セイバー/g,"Saber").replace(/竜/g,"龍")+"</td><td colspan=4>";
							
							if(master.mstSvtTreasureDevice[k].num==98) skillText+="敵人或特殊支援限定";
							else if(master.mstSvtTreasureDevice[k].condQuestId==0&&master.mstSvtTreasureDevice[k].condLv==0&&master.mstSvtTreasureDevice[k].condFriendshipRank==0) skillText+="初期";
							else if(findName(master.mstQuest,master.mstSvtTreasureDevice[k].condQuestId)!=null)
							{
								skillText+=questRea(master.mstSvtTreasureDevice[k].condQuestId);
							}
							else if(master.mstSvtTreasureDevice[k].condLv!=0) skillText+="Lv."+master.mstSvtTreasureDevice[k].condLv+"解放";
							else if(master.mstSvtTreasureDevice[k].condFriendshipRank!=0) skillText+="絆等級"+master.mstSvtTreasureDevice[k].condFriendshipRank+"解放";
							else skillText+="未開放";
							
							skillText+="</td>"; //break;}
					//}
					var tdDetailTxt = new Array();
					for(d in tdDetail){
						if(master.mstTreasureDevice[c].id==tdDetail[d][0]){
							tdDetailTxt = tdDetail[d].slice(0);break;
						}
					}
					if(document.getElementById('isJpTxt').checked||!tdDetailTxt[1])
						for(d in master.mstTreasureDeviceDetail){
							if(master.mstTreasureDevice[c].id==master.mstTreasureDeviceDetail[d].id){
								tdDetailTxt[1] = master.mstTreasureDeviceDetail[d].detail;break;
							}
						}
					
					skillText+="<td colspan=2>";
					if(tdDetailTxt[1].search(/攻擊[^力]|攻撃[^力]/)==-1) skillText+="－";
					else
					{
						if(master.mstSvtTreasureDevice[k].damage.length>0) skillText+=master.mstSvtTreasureDevice[k].damage.length;
						else skillText+="1";
						skillText+="Hit";
						if(master.mstSvtTreasureDevice[k].damage.length>1) skillText+="s";
					}
					skillText+="</td></tr>";
					
					var tdDetailArray = new Array();
					if(!document.getElementById('isJpTxt').checked)
					{
						tdDetailTxt[1]=tdDetailTxt[1].replace(/ ＋ |　＋　/g,"＋");
						tdDetailTxt[1]=tdDetailTxt[1].replace(/＆/g,"＆┗");
						tdDetailArray = tdDetailTxt[1].split(/＆|＋/);
					}
					else tdDetailArray[0] = tdDetailTxt[1].slice(0);
					
					skillrowCount+=tdDetailArray.length;
					for(var d=0;d<tdDetailArray.length;d++){
						var isLvUp = tdDetailArray[d].search(/\{0\}|Lv/);
						var isOCUp = tdDetailArray[d].search(/<O|<オ/);
						tdDetailArray[d]=tdDetailArray[d].replace(/\{0\}/g,"Lv.");
						tdDetailArray[d]=tdDetailArray[d].replace(/<O/g,"<font color=\"#CC6600\"><br>< O");
						tdDetailArray[d]=tdDetailArray[d].replace(/<オ/g,"<font color=\"#CC6600\"><オ");
						tdDetailArray[d]=tdDetailArray[d].replace(/P>/g,"P></font>");
						tdDetailArray[d]=tdDetailArray[d].replace(/プ>/g,"プ></font>");
						tdDetailArray[d]=tdDetailArray[d].replace(/【/g,"<font color=\"#006400 \">【");
						tdDetailArray[d]=tdDetailArray[d].replace(/】/g,"】</font>");
						tdDetailArray[d]=tdDetailArray[d].replace(/\[Lv.]/g,"<font color=\"#CC00CC \">[Lv.]</font>");
						tdDetailArray[d]=tdDetailArray[d].replace(/\n/g,"<br>");
						tdDetailArray[d]=tdDetailArray[d].replace(/\[g\]\[o\]▲\[\/o\]\[\/g\]/g,"<font color=\"#ff7f0f \">▲</font>");
						
						if(document.getElementById('isJpTxt').checked) skillText+="<td colspan=12>"+tdDetailArray[d]+"</td>";
						
						else{
							if(d!=0) skillText+="<tr>"
							skillText+="<td colspan=2>"+tdDetailArray[d]+"</td>";
								
							if(/*(isLvUp!=-1||isOCUp!=-1)&&*/tdDetailTxt[2+d]&&tdDetailTxt[2+d].split("/").length-1>1){
								var skLvArray = new Array();
									skLvArray = tdDetailTxt[2+d].split(/\//);
								for(g in skLvArray)
									skillText+="<td align=center colspan=2>"+skLvArray[g]+"</td>";
							}
							else{
								skillText+="<td colspan=10>";
								if(tdDetailTxt[2+d]) skillText+="　"+tdDetailTxt[2+d]/*.replace(/\//g," / ")*/;
								else if(typeof tdDetailTxt[2+d] !== 'undefined'&&tdDetailTxt[2+d].length==0) skillText+=("　---");
								else skillText+="　待補";
							}
						}
						skillText+="</td></tr>";
					}
					break;
				}
			}
		}
	}
	if(skillText.length>0) svtSkTdDataTxt+="<tr><th rowspan="+skillrowCount+" style='width:60px'><b>寶具</b></th>"+skillText+"";
	//svtSkTdDataTxt+="<tr><td colspan=6><p class=\"notice\">※若未註明效果的對象，則與跟前一個效果對象相同。</p></td></tr>";
	document.getElementById("svtSkTdData").innerHTML=svtSkTdDataTxt;
	
	var svtInfoDataTxt="";
	svtInfoDataTxt='<tr><th rowspan=2 style="width:250px">能力值</th><th style="width:80px">筋力</th><th style="width:80px">耐久</th><th style="width:80px">敏捷</th><th style="width:80px">魔力</th><th style="width:80px">幸運</th><th style="width:80px">寶具</th></tr><tr align="center"><td>'+svtStatusList[Math.floor(tmpSvtLimit.power/10)]+svtStatusPlusList[tmpSvtLimit.power%10]+'</td><td>'+svtStatusList[Math.floor(tmpSvtLimit.defense/10)]+svtStatusPlusList[tmpSvtLimit.defense%10]+'</td><td>'+svtStatusList[Math.floor(tmpSvtLimit.agility/10)]+svtStatusPlusList[tmpSvtLimit.agility%10]+'</td><td>'+svtStatusList[Math.floor(tmpSvtLimit.magic/10)]+svtStatusPlusList[tmpSvtLimit.magic%10]+'</td><td>'+svtStatusList[Math.floor(tmpSvtLimit.luck/10)]+svtStatusPlusList[tmpSvtLimit.luck%10]+'</td><td>'+svtStatusList[Math.floor(tmpSvtLimit.treasureDevice/10)]+svtStatusPlusList[tmpSvtLimit.treasureDevice%10]+'</td></tr>';
	
	if(master.mstSvt[i].friendshipId!=1000)
	{
	var svtFsId=findSvtFs(master.mstSvt[i].id),maxFsLv=5,svtFsArr=new Array();
	if(svtFsId!=master.mstSvt[i].friendshipId||master.mstSvt[i].maxFriendshipRank==10) {maxFsLv=10;}
	svtInfoDataTxt+='<tr><th rowspan='+((maxFsLv==10) ? 15 : 5)*2/5+'>絆點數<br>(累積)</th><th>Lv.1</th><th>Lv.2</th><th>Lv.3</th><th>Lv.4</th><th>Lv.5</th><th>';
	if(maxFsLv==10) svtInfoDataTxt+='專屬禮裝';
	svtInfoDataTxt+='</th></tr><tr align="center">';
	for(c in master.mstFriendship)
	{
		if(master.mstFriendship[c].id==svtFsId&&master.mstFriendship[c].rank<15)
		{
			svtFsArr[master.mstFriendship[c].rank]=master.mstFriendship[c].friendship;
		}
		//if(svtFsArr.length==maxFsLv) break;
	}
	for(c=0;c<5;c++)
	{
		if(c==0) svtInfoDataTxt+='<td>'+svtFsArr[c]+'</td>';
		else svtInfoDataTxt+='<td>'+(svtFsArr[c]-svtFsArr[c-1])+'<br>('+svtFsArr[c]+')</td>';
	}
	
	if(maxFsLv==10) 
	{
		svtInfoDataTxt+='<td rowspan=5>';
		for(var b in bondCE)
		{
			if(bondCE[b][1]==master.mstSvt[i].id)
			{
				svtInfoDataTxt+=svtFace(bondCE[b][0]);break;
			}
		}svtInfoDataTxt+='</td></tr>';
	}
	else svtInfoDataTxt+='<td></td></tr>';
	
	if(maxFsLv==10)
	{
		svtInfoDataTxt+='<tr><th>Lv.6</th><th>Lv.7</th><th>Lv.8</th><th>Lv.9</th><th>Lv.10</th></tr><tr align="center">';
		for(c=5;c<10;c++)
		{
			svtInfoDataTxt+='<td>'+(svtFsArr[c]-svtFsArr[c-1])+'<br>('+svtFsArr[c]+')</td>';
		}
		svtInfoDataTxt+='</tr><tr><th>Lv.11</th><th>Lv.12</th><th>Lv.13</th><th>Lv.14</th><th>Lv.15</th></tr><tr align="center">';
		for(c=10;c<15;c++)
		{
			svtInfoDataTxt+='<td>'+(svtFsArr[c]-svtFsArr[c-1])+'<br>('+svtFsArr[c]+')</td>';
		}
		svtInfoDataTxt+='</tr>';
	}
	
	}
	
/*$.getScript("https://www.gstatic.com/firebasejs/3.3.0/firebase.js", function(){
  var config = {
    apiKey: "AIzaSyAAstnsWNNxN6yE_Yk6xC6weTMd1WxFDhk",
    authDomain: "fgovz-ac5ee.firebaseapp.com",
    databaseURL: "https://fgovz-ac5ee.firebaseio.com",
    storageBucket: "fgovz-ac5ee.appspot.com",
  };
  firebase.initializeApp(config);
  firebase.database().ref("mstSvtCommentZh/"+master.mstSvt[i].id).once('value').then(function(snapshot) {*/
if(master.mstSvt[i].collectionNo>zhCNNo)
{
	$('#cmtlang_zh').prop('checked',false);
	$('#cmtlang_jp').prop('checked',true);
	//console.log($('#cmtlang_jp').attr('checked'));
}
cmtRead($('input[name=cmtlang]:checked').val());
	/*for(c=0;c<master.mstSvtComment.length;c++)
	{
		var tdColor="";
		if(master.mstSvt[i].id==master.mstSvtComment[c].svtId)
		{	svtInfoDataTxt+="<tr><th width=150>";
			var tmpValue = 0;
			if(master.mstSvtComment[c].condValues!=null&&master.mstSvtComment[c].condValues.length>0) tmpValue=master.mstSvtComment[c].condValues[0];
			else tmpValue=master.mstSvtComment[c].condValue;
			if(master.mstSvtComment[c].condType==0) svtInfoDataTxt+="<b>角色詳細</b>";
			else if(master.mstSvtComment[c].condType==9) 
			{
				svtInfoDataTxt+="<b>絆等級"+tmpValue+"</b>";
			}
			else if(master.mstSvtComment[c].condType==1){
				svtInfoDataTxt+="<b>通過關卡</b><br>"+questRea(tmpValue);
			}
			svtInfoDataTxt+="</th>";
			if(master.mstSvtComment[c].id%2==1) tdColor=" bgcolor=\" #ECF2F3\""; else tdColor="";
			svtInfoDataTxt+="<td colspan=6"+tdColor+">";
			var commentStr = null;//snapshot.child(master.mstSvtComment[c].id).val();
			

			if(commentStr==null||document.getElementById('isJpTxt').checked)
				commentStr = master.mstSvtComment[c].comment;
			svtInfoDataTxt+=commentStr.replace(/\n/g,"<br>").replace(/<br>$/,"<br><br>")+"</td></tr>";
			//if(master.mstSvtComment[c].condType==1) break;
		}
	}*/
	$('#svtInfoData').html(svtInfoDataTxt);
/*  });
});*/
	var svtCmbnDataTxt='';
	svtCmbnDataTxt='<tr><th rowspan=4><b>靈基再臨</b></th>';

	for(var m=0;m<4;m++){
		var tdColor=''; if(m%2==0) tdColor=' bgcolor=" #ECF2F3"';
		if(m!=0) svtCmbnDataTxt+='<tr>';
		svtCmbnDataTxt+='<td width=80 '+tdColor+'>第'+(m+1)+'階段</td><td width=450'+tdColor+'>';
		for(c=0;c<master.mstCombineLimit.length;c++)
		{
			if(master.mstCombineLimit[c].id==master.mstSvt[i].id&&master.mstCombineLimit[c].svtLimit==m)
			{
				
				for(var k=0;k<master.mstCombineLimit[c].itemIds.length;k++)
				{
					svtCmbnDataTxt+='<a href="item_drop.html#'+master.mstCombineLimit[c].itemIds[k]+'"><div class="itemMT" title="'+findItemName(master.mstCombineLimit[c].itemIds[k]) + '" style="background-image: url(\'common/images/icon/items/'+master.mstCombineLimit[c].itemIds[k]+'.png\')" >'+master.mstCombineLimit[c].itemNums[k]+'</div></a><div style="width:10px;display:inline-block;"></div>';
				}
				svtCmbnDataTxt+= '<div class="itemMT" title="QP" style="background-image: url(\'common/images/icon/items/5.png\')" >'+addCommas(master.mstCombineLimit[c].qp)+'</div>';
			}
	}svtCmbnDataTxt+='</td></tr>';}
	svtCmbnDataTxt+='<tr><th rowspan=9><b>技能強化</b></th>';var combineCount = 0;
	for(c=0;c<master.mstCombineSkill.length;c++)
	{
		var tdColor=''; if(c%2==0) tdColor=' bgcolor=" #ECF2F3"';
		if(master.mstCombineSkill[c].id==master.mstSvt[i].id)
		{
			if(master.mstCombineSkill[c].skillLv!=1) svtCmbnDataTxt+='<tr>';
			svtCmbnDataTxt+='<td'+tdColor+'>Lv.'+master.mstCombineSkill[c].skillLv+'→Lv.'+(master.mstCombineSkill[c].skillLv+1)+'</td><td'+tdColor+'>';
			for(var k=0;k<master.mstCombineSkill[c].itemIds.length;k++)
			{
				svtCmbnDataTxt+='<a href="item_drop.html#'+master.mstCombineSkill[c].itemIds[k]+'"><div class="itemMT" title="'+findItemName(master.mstCombineSkill[c].itemIds[k]) + '" style="background-image: url(\'common/images/icon/items/'+master.mstCombineSkill[c].itemIds[k]+'.png\')" >'+master.mstCombineSkill[c].itemNums[k]+'</div></a><div style="width:10px;display:inline-block;"></div>';
			}
			svtCmbnDataTxt+= '<div class="itemMT" title="QP" style="background-image: url(\'common/images/icon/items/5.png\')" >'+addCommas(master.mstCombineSkill[c].qp)+'</div>';combineCount++;
		}
	}
	if(combineCount==0) svtCmbnDataTxt+='<td colspan=2>無</td></tr>';
	$('#svtCmbnData').html(svtCmbnDataTxt);

	$('#svtImgData').html('<tr><td><span id="cmd"><img src="common/images/Servant/'+svtId+'_card_servant_1.png" style="max-width:20%;" class="svtImg"/><img src="common/images/Servant/'+svtId+'_card_servant_2.png" style="max-width:20%;" class="svtImg"/><img src="common/images/Servant/'+svtId+'_card_servant_3.png" style="max-width:20%;" class="svtImg"/></span><br><span id="graph"><img src=common/images/CharaGraph/'+svtId+'a.png style="max-width:100%;" class="svtImg"/><img src=common/images/CharaGraph/'+svtId+'b.png style="max-width:100%;" class="svtImg"/><img src=common/images/CharaGraph/'+svtId+'c.png style="max-width:50%;" class="svtImg"/></span></td></tr>');
	for(c in master.mstSvtLimitAdd)
	{
		if(master.mstSvtLimitAdd[c].svtId==master.mstSvt[i].id)
		{//console.log('靈衣'+master.mstSvtLimitAdd[c].battleCharaId);
			$('#cmd').append('<img src="common/images/Servant/'+svtId+'_card_servant_'+master.mstSvtLimitAdd[c].limitCount+'.png" style="max-width:20%;" class="svtImg"/>');
			$('#graph').append('<img src=common/images/CharaGraph/'+master.mstSvtLimitAdd[c].battleCharaId+'a.png style="max-width:50%;" class="svtImg"/>');
			if(master.mstSvt[i].collectionNo<=statusNo)
			{
				$('.slide').append('<div><img src="common/images/Servant/'+svtId+'_status_servant_'+master.mstSvtLimitAdd[c].limitCount+'.png" onerror="this.style.display = none" width=256 height=256 /></div>');
			}
		}
	}
    $('.svtImg').error(function () {
        $(this).hide();
    });
	var svtLvDataTxt="";if(tmpSvtLimitMax!=null&&(tmpSvtLimit.hpBase!=tmpSvtLimitMax.hpBase||tmpSvtLimit.hpMax!=tmpSvtLimitMax.hpMax||tmpSvtLimit.atkBase!=tmpSvtLimitMax.atkBase||tmpSvtLimit.atkMax!=tmpSvtLimitMax.atkMax)) tmpSvtLimit=tmpSvtLimitMax;
	if(master.mstSvt[i].type==99) $('#chart_div').css('display','none');
	else{$('#chart_div').css('display','block');
	svtLvDataTxt='<tr><th>等級</th><th>ATK</th><th>HP</th><th>上升幅度</th></tr>';
	for(c=0;c</*master.mstSvt[i].rewardLv*/100;c++)
	{
		for(var m=0;m<master.mstSvtExp.length;m++)
		{
			if(master.mstSvt[i].expType==master.mstSvtExp[m].type&&master.mstSvtExp[m].lv==c+1)
			{
				var tdColor=''; if(master.mstSvtExp[m].lv%2==1) tdColor=' bgcolor="#ECF2F3"';
				svtLvDataTxt+='<tr align="center"><td'+tdColor+'>Lv.'+(master.mstSvtExp[m].lv)+'</td><td'+tdColor+'>'+Math.floor(tmpSvtLimit.atkBase+(tmpSvtLimit.atkMax-tmpSvtLimit.atkBase)*master.mstSvtExp[m].curve/1000)+'</td><td'+tdColor+'>'+Math.floor(tmpSvtLimit.hpBase+(tmpSvtLimit.hpMax-tmpSvtLimit.hpBase)*master.mstSvtExp[m].curve/1000)+'</td><td'+tdColor+'>'+(master.mstSvtExp[m].curve-master.mstSvtExp[m-1].curve)/10+'%</td></tr>';
				break;
			}
		}
	}}
	$('#svtLvData').html(svtLvDataTxt);
	$("img.lazyload").lazyload();
	/*$("img").error(function () { 
    //$(this).hide();
    $(this).css({visibility:"hidden"}); 
	});*/
$(function() {
    $('.slide').slick({
        dots: true,
        infinite: true,
        speed: 300,
        slidesToShow: 1,
        adaptiveHeight: true,
		autoplay: true,
		autoplaySpeed: 2000,
    });
});
}
function cmtRead(langVal)
{
	try
	{
		$.get('common/svtcomment/'+langVal+'/'+$('#svtid').val(), function(data) {
		   if(data.length==0) data="W10=";
		   var svtComment = JSON.parse(base64.decode(data));
		   var tdColor='',cmtTxt='';
		   for(var sc in svtComment)
		   {
			   var tmpVal = 0;
			   if(svtComment[sc].condValues!=null&&svtComment[sc].condValues.length>0)
				   tmpVal=svtComment[sc].condValues[0];
			   else tmpVal=svtComment[sc].condValue;

			   cmtTxt+='<tr><th width=250>'+cmtCond(svtComment[sc].condType,tmpVal);
			   for(var sca in master.mstSvtCommentAdd)
			   {
				   if(master.mstSvtCommentAdd[sca].svtId==svtComment[sc].svtId&&master.mstSvtCommentAdd[sca].id==svtComment[sc].id)
					   cmtTxt+='<br>＆<br>'+cmtCond(master.mstSvtCommentAdd[sca].condType,master.mstSvtCommentAdd[sca].condValues[0]);
			   }
				if(svtComment[sc].id%2==1) tdColor=' bgcolor=" #ECF2F3"'; else tdColor='';
				cmtTxt+='</th><td colspan=6'+tdColor+' width=540>';

				cmtTxt+=svtComment[sc].comment.replace(/\n/g,'<br>').replace(/<br>$/,'<br><br>')+'</td></tr>';
		   }
		   if(svtComment.length==0) cmtTxt="";
		   $('#svtCmtData').empty();
		   $('#svtCmtData').append(cmtTxt);
		}, 'text');
	}
catch(err){console.log('Cannot find comment file.');if(langVal=='zh')cmtRead('jp')}

}
function cmtCond(type,val)
{
	var condTxt = '';
	if(type==0) condTxt+='<b>角色詳細</b>';
	else if(type==9) 
	{
		condTxt+='<b>絆等級'+val+'</b>';
	}
	else if(type==1){
		condTxt+='<b>通過關卡</b><br>'+questRea(val);
	}
	else if(type==7){
		condTxt+='<b>靈基再臨第'+val+'階段</b>';
	}
	return condTxt;
}
function classidChange()
{
	var i;
	for(i=svtid.options.length-1;i>=0;i--)
    {
        svtid.remove(i);
    }
	/*if(classid.value==0)
	{
		for(i=0;i<master.mstSvt.length;i++)
		{
			if(master.mstSvt[i].type==1||master.mstSvt[i].type==2||master.mstSvt[i].type==5||master.mstSvt[i].type==9||master.mstSvt[i].type==99){
				var svtNameZh = findSvtNameZh(master.mstSvt[i].id);
				if(svtNameZh) svtid.options.add(new Option("No." + master.mstSvt[i].collectionNo + " " + svtNameZh,master.mstSvt[i].id));
				else svtid.options.add(new Option("No." + master.mstSvt[i].collectionNo + " " + master.mstSvt[i].name,master.mstSvt[i].id));}
		}
	}
	else
	{*/
		for(i=0;i<master.mstSvt.length;i++)
		{
			if(classid.value==0||master.mstSvt[i].classId==classid.value)
				{if(master.mstSvt[i].type==1||master.mstSvt[i].type==2||master.mstSvt[i].type==5||master.mstSvt[i].type==9||master.mstSvt[i].type==99){
				var svtNameZh = findSvtNameZh(master.mstSvt[i].id);
				if(svtNameZh) svtid.options.add(new Option("No." + master.mstSvt[i].collectionNo + " " + svtNameZh,master.mstSvt[i].id));
				else svtid.options.add(new Option("No." + master.mstSvt[i].collectionNo + " " + master.mstSvt[i].name,master.mstSvt[i].id));}}
		}
	//}
	for(i=0;i<svtid.options.length;i++)
    {
		if(svtid.options[i].text.search("No.0")==-1)
		{
			svtid.options[i].selected=true;
			break;
		}
    }
	if(classid.value!=0) svtlocation(svtid[svtid.options.selectedIndex].value);

}
function svtidset()
{
	classidChange();
	svtlocation(svtid[0].value);
}
function svtidChange()
{
	var i;
	for(i=svtlv.options.length-1;i>=0;i--)
    {
        svtlv.remove(i);
    }
	for(i in master.mstSvt)
	{
		if(master.mstSvt[i].id==svtid.value)
		{
			//for(var j=1;j<=/*master.mstSvt[i].rewardLv*/100;j++)
			for(var j=100;j>0;j--)
			{
				svtlv.options.add(new Option("Lv."+j,j));
			}
			break;
		}
	}
	svtlvChange();
	svtDataTable(svtid.value);drawChart();
}
function svtlocation(svtId)
{
	var localTxt="";
	for(var i in master.mstSvt)
	{
		if(master.mstSvt[i].id==svtid.value)
		{
			if(master.mstSvt[i].collectionNo!=0) localTxt+="?no="+master.mstSvt[i].collectionNo;
			else localTxt+="?id="+master.mstSvt[i].id;
			break;
		}
	}
	//document.location.href="svtData.html"+localTxt;
	//alert(location.protocol+'//'+location.pathname+localTxt);
	
	if(location.protocol=="file:") changeURL(location.protocol+"//"+location.pathname+localTxt);
	else changeURL(location.protocol+"//"+location.hostname+location.pathname+localTxt);
	svtidChange();
}
function svtlvChange()
{
	var i,hpBase=0,hpMax=0,atkBase=0,atkMax=0;
	for(i in master.mstSvtLimit)
	{
		if(master.mstSvtLimit[i].svtId==svtid.value)
		{
			hpBase=master.mstSvtLimit[i].hpBase;
			hpMax=master.mstSvtLimit[i].hpMax;
			atkBase=master.mstSvtLimit[i].atkBase;
			atkMax=master.mstSvtLimit[i].atkMax;
		}
	}
	for(var k in master.mstSvt)
	{
		if (master.mstSvt[k].id==svtid.value)
		{
			for(var j in master.mstSvtExp)
			{	atk.value=atkBase;hp.value=hpBase;four();
				if(master.mstSvt[k].expType==master.mstSvtExp[j].type&&master.mstSvtExp[j].lv==svtlv.value)
				{
					atk.value=Math.floor(atkBase+(atkMax-atkBase)*master.mstSvtExp[j].curve/1000);
					hp.value=Math.floor(hpBase+(hpMax-hpBase)*master.mstSvtExp[j].curve/1000);
					four();break;
				}
			}
		break;
		}
	}
}
function four()
{
	hpp.value=parseInt(hp.value)+2000;atkp.value=parseInt(atk.value)+2000;
}
function npArray(npPointArr)
{
	var txt="";
	for(var i in npPointArr)
	{
		txt+=npPointArr[i]/100+"%<br>";
	}
	return txt;
}
function urlId()
{$('#zhTWNO').html(zhTWNo);$('#zhCNNO').html(zhCNNo);
	$("#classid").val(0);classidChange();
	var getSvtId = "1";
	var getSvtId2 = "";
	if(getUrl("no")) getSvtId = getUrl("no");
	if(getUrl("id")) getSvtId2 = getUrl("id");
	if(getSvtId){
		if(getSvtId2.length!=0){
			for(i in master.mstSvt)
				if((master.mstSvt[i].type==1||master.mstSvt[i].type==2||master.mstSvt[i].type==5||master.mstSvt[i].type==9||master.mstSvt[i].type==99)&&getSvtId2==master.mstSvt[i].id)
				{		$("#svtid").val(master.mstSvt[i].id);break;}
		}
		else
			for(i in master.mstSvt)
				if((master.mstSvt[i].type==1||master.mstSvt[i].type==2||master.mstSvt[i].type==5||master.mstSvt[i].type==9||master.mstSvt[i].type==99)&&getSvtId==master.mstSvt[i].collectionNo)
				{		$("#svtid").val(master.mstSvt[i].id);break;}
		if(i==master.mstSvt.length-1) $("#svtid").val(800100);
		//if(i==master.mstSvt.length-1) alert("找不到與輸入的id有關之資料，請確認網址無誤");
	}
	svtidChange();
}